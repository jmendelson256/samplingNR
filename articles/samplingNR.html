<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="samplingNR">
<title>Sample allocation example: 2016 PEVS-ADM • samplingNR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample allocation example: 2016 PEVS-ADM">
<meta property="og:description" content="samplingNR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">samplingNR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/samplingNR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jmendelson256/samplingNR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sample allocation example: 2016 PEVS-ADM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jmendelson256/samplingNR/blob/HEAD/vignettes/samplingNR.Rmd" class="external-link"><code>vignettes/samplingNR.Rmd</code></a></small>
      <div class="d-none name"><code>samplingNR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The example below shows how to use the <code>samplingNR</code>
package to allocate a sample of 50,000 invitees, using methods described
in our paper when assuming equivalent strata variances across strata
(i.e., <span class="math inline">\(S_h = S\)</span> for some constant
<span class="math inline">\(S\)</span>). The example shows how to
replicate our paper’s Table 2, which compares the proposed allocation
with common alternatives in an application to a survey of military
personnel.</p>
<p>The stratification, population counts, and response rate information
used in this example are included in our package as the data set
<code>pevs_adm_2016_rrs</code>, structured as a <a href="https://tibble.tidyverse.org/" class="external-link">tibble</a>. These data are based on
secondary analysis of public use data for the 2016 Post-Election Voting
Survey of Active Duty Military (PEVS-ADM; Federal Assistance Voting
Program, 2017a, 2017b), as described in our paper.</p>
</div>
<div class="section level2">
<h2 id="compute-allocations">Compute allocations<a class="anchor" aria-label="anchor" href="#compute-allocations"></a>
</h2>
<div class="section level3">
<h3 id="exact-optimal-allocation-iterative">Exact optimal allocation (iterative)<a class="anchor" aria-label="anchor" href="#exact-optimal-allocation-iterative"></a>
</h3>
<p>The function <code><a href="../reference/opt_nh_nonresp.html">opt_nh_nonresp()</a></code> calculates the exact
(i.e., iteratively computed) version of the optimal allocation under
nonresponse, as provided in our paper and summarized in the function
documentation. We assume that stratification follows that of
<code>pevs_adm_2016_rrs</code>, and specify the strata population sizes
<code>N_h</code> and anticipated response propensities
<code>phibar_h</code>. We have omitted the optional argument
<code>S_h</code>, leading to use of the default assumption that <span class="math inline">\(S_h\)</span> is constant across strata. Note that
by fixing the total number of invitees (<code>n_max</code>), we are
implicitly assuming use of the <em>constant cost per invitee</em>
scenario from our paper (i.e., per unit costs are assumed constant
across strata and do not vary by response status).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jmendelson256/samplingNR" class="external-link">samplingNR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Compute exact optimum allocation for PEVS-ADM 2016 data set for n = 50k</span></span>
<span><span class="co">#Assumes tau = 1 by default</span></span>
<span><span class="va">pevs_optE_alloc_50k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opt_nh_nonresp.html">opt_nh_nonresp</a></span><span class="op">(</span>N_h <span class="op">=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span>,</span>
<span>                                      phibar_h <span class="op">=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">rr_h</span>,</span>
<span>                                      n_max <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Merge results into original data frame</span></span>
<span><span class="va">pevs_adm_alloc_50k_merged</span> <span class="op">&lt;-</span> <span class="va">pevs_adm_2016_rrs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_h_optE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pevs_optE_alloc_50k</span><span class="op">)</span>,</span>
<span>                zeta_h_optE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pevs_optE_alloc_50k</span>,<span class="st">"zeta_h_prev"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#View results</span></span>
<span><span class="va">pevs_adm_alloc_50k_merged</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 91 × 10</span></span></span>
<span><span class="co">#&gt;    h     service paygrade age   region  sex   Nhat_h   rr_h n_h_optE zeta_h_optE</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     Army    E1-E5    18-24 US      M     1.09<span style="color: #949494;">e</span>5 0.018<span style="text-decoration: underline;">9</span>    <span style="text-decoration: underline;">8</span>267.        1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2     Army    E1-E5    18-24 US      F     1.89<span style="color: #949494;">e</span>4 0.036<span style="text-decoration: underline;">4</span>    <span style="text-decoration: underline;">1</span>041.        1.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3     Army    E1-E5    18-24 Overse… M     1.85<span style="color: #949494;">e</span>4 0.021<span style="text-decoration: underline;">4</span>    <span style="text-decoration: underline;">1</span>333.        1.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4     Army    E1-E5    18-24 Overse… F     3.31<span style="color: #949494;">e</span>3 0.043<span style="text-decoration: underline;">1</span>     179.        1.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5     Army    E1-E5    25-29 US      M     4.83<span style="color: #949494;">e</span>4 0.048<span style="text-decoration: underline;">7</span>    <span style="text-decoration: underline;">2</span>280.        1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6     Army    E1-E5    25-29 US      F     8.68<span style="color: #949494;">e</span>3 0.061<span style="text-decoration: underline;">9</span>     370.        1.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7     Army    E1-E5    25-29 Overse… M/F   1.08<span style="color: #949494;">e</span>4 0.056<span style="text-decoration: underline;">6</span>     477.        1.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8     Army    E1-E5    30-34 US      M/F   2.14<span style="color: #949494;">e</span>4 0.089<span style="text-decoration: underline;">1</span>     746.        1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9     Army    E1-E5    30-34 Overse… M/F   3.74<span style="color: #949494;">e</span>3 0.090<span style="text-decoration: underline;">4</span>     135.        1.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10    Army    E1-E5    35+   US      M/F   9.06<span style="color: #949494;">e</span>3 0.188      219.        1.02</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 81 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="approximately-optimal-allocation">Approximately optimal allocation<a class="anchor" aria-label="anchor" href="#approximately-optimal-allocation"></a>
</h3>
<p>The approximate version of this allocation, which assumes that <span class="math inline">\(\zeta_h(n_h,\bar{\phi}_h) = 1\)</span>, can be
computed using the function <code><a href="../reference/opt_nh_nonresp.html">opt_nh_nonresp_oneiter()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pevs_optA_alloc_50k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opt_nh_nonresp.html">opt_nh_nonresp_oneiter</a></span><span class="op">(</span>N_h <span class="op">=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span>,</span>
<span>                                              phibar_h <span class="op">=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">rr_h</span>,</span>
<span>                                              n_max <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="neyman-style-allocations-for-comparison">Neyman-style allocations for comparison<a class="anchor" aria-label="anchor" href="#neyman-style-allocations-for-comparison"></a>
</h3>
<p>For comparison, we also compute Neyman allocation of invitees (<span class="math inline">\(n_h^{\textrm{Ninv}}\propto N_h S_h\)</span>),
which does not adjust for differential nonresponse, and Neyman
allocation of expected respondents (<span class="math inline">\(n_h^{\textrm{Nresp}}\propto N_h S_h /
\bar{\phi}_h\)</span>), which adjusts by the inverse of the anticipated
response rates. In each case, we ignore the <span class="math inline">\(S_h\)</span> terms in our applications of these
equations, for purposes of this example, given our earlier assumption of
equivalent strata variances.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nh_Ninv_propto</span> <span class="op">&lt;-</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span></span>
<span><span class="va">nh_Ninv</span> <span class="op">&lt;-</span> <span class="va">nh_Ninv_propto</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nh_Ninv_propto</span><span class="op">)</span> <span class="op">*</span> <span class="fl">50000</span></span>
<span></span>
<span><span class="va">nh_Nresp_propto</span> <span class="op">&lt;-</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span> <span class="op">/</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">rr_h</span></span>
<span><span class="va">nh_Nresp</span> <span class="op">&lt;-</span> <span class="va">nh_Nresp_propto</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nh_Nresp_propto</span><span class="op">)</span> <span class="op">*</span> <span class="fl">50000</span></span>
<span></span>
<span><span class="co">#Make sure allocations are valid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">nh_Ninv</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">nh_Ninv</span> <span class="op">&lt;=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">nh_Nresp</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">nh_Nresp</span> <span class="op">&lt;=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="view-allocations">View allocations<a class="anchor" aria-label="anchor" href="#view-allocations"></a>
</h2>
<p>The resulting allocations can be seen to match those shown in our
paper’s Appendix.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">pevs_adm_allocs_50k</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pevs_adm_alloc_50k_merged</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_h_optA <span class="op">=</span> <span class="va">pevs_optA_alloc_50k</span>,</span>
<span>         n_h_Ninv <span class="op">=</span> <span class="va">nh_Ninv</span>,</span>
<span>         n_h_Nresp <span class="op">=</span> <span class="va">nh_Nresp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"h"</span>, <span class="st">"n_h_Ninv"</span>, <span class="st">"n_h_Nresp"</span>, <span class="st">"n_h_optA"</span>, <span class="st">"n_h_optE"</span>, <span class="st">"zeta_h_optE"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 91 × 6</span></span></span>
<span><span class="co">#&gt;    h     n_h_Ninv n_h_Nresp n_h_optA n_h_optE zeta_h_optE</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1        <span style="text-decoration: underline;">4</span>269.   <span style="text-decoration: underline;">12</span>975.     <span style="text-decoration: underline;">8</span>309.    <span style="text-decoration: underline;">8</span>267.        1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2         740.    <span style="text-decoration: underline;">1</span>164.     <span style="text-decoration: underline;">1</span>036.    <span style="text-decoration: underline;">1</span>041.        1.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3         722.    <span style="text-decoration: underline;">1</span>935.     <span style="text-decoration: underline;">1</span>320.    <span style="text-decoration: underline;">1</span>333.        1.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4         129.     172.      167.     179.        1.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5        <span style="text-decoration: underline;">1</span>890.    <span style="text-decoration: underline;">2</span>225.     <span style="text-decoration: underline;">2</span>289.    <span style="text-decoration: underline;">2</span>280.        1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6         339.     314.      364.     370.        1.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7         421.     426.      473.     477.        1.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8         835.     537.      747.     746.        1.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9         146.      92.6     130.     135.        1.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10        354.     108.      218.     219.        1.02</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 81 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluate-performance">Evaluate performance<a class="anchor" aria-label="anchor" href="#evaluate-performance"></a>
</h2>
<p>Further, we can roughly examine performance by computing the number
of respondents, the design effect from weighting (<span class="math inline">\(deff_w\)</span>; Kish, 1992), and the effective
number of respondents under each allocation, replicating Table 2 of our
paper. The results show that under the given assumptions, the proposed
allocation has an effective sample size that is 25% higher than the
Neyman-style allocations.</p>
<div class="section level3">
<h3 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Calculate Kish's deff_w for poststratified estimator under nonresponse</span></span>
<span><span class="va">calculate_deff_w</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">N_h</span>, <span class="va">r_h</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">N_h</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_h</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">r_h</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">r_h</span> <span class="op">&lt;=</span> <span class="va">N_h</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">r_h</span> <span class="op">&lt;=</span> <span class="va">N_h</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">w_h</span> <span class="op">&lt;-</span> <span class="va">N_h</span><span class="op">/</span><span class="va">r_h</span></span>
<span></span>
<span>  <span class="va">wbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w_h</span> <span class="op">*</span> <span class="va">r_h</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_h</span><span class="op">)</span></span>
<span>  <span class="va">deff_w</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r_h</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">w_h</span> <span class="op">-</span> <span class="va">wbar</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">r_h</span><span class="op">)</span><span class="op">/</span><span class="va">wbar</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span>  <span class="op">(</span><span class="va">deff_w</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Summarize results from allocation under assumption that r_h = n_h * phibar_h</span></span>
<span><span class="va">summarize_alloc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N_h</span>, <span class="va">phibar_h</span>, <span class="va">n_h</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_h</span><span class="op">)</span></span>
<span>  <span class="va">r_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">phibar_h</span> <span class="op">*</span> <span class="va">n_h</span><span class="op">)</span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="va">r_total</span> <span class="op">/</span> <span class="va">n_total</span></span>
<span>  <span class="va">deff_w</span> <span class="op">&lt;-</span> <span class="fu">calculate_deff_w</span><span class="op">(</span>N_h <span class="op">=</span> <span class="va">N_h</span>, r_h <span class="op">=</span> <span class="va">n_h</span> <span class="op">*</span> <span class="va">phibar_h</span><span class="op">)</span></span>
<span>  <span class="va">eff_resp</span> <span class="op">&lt;-</span> <span class="va">r_total</span> <span class="op">/</span> <span class="va">deff_w</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_total</span>, <span class="va">r_total</span>, <span class="va">rr</span>, <span class="va">deff_w</span>, <span class="va">eff_resp</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Summarize results of each allocation</span></span>
<span><span class="va">pevs_adm_alloc_summary_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>         <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu">summarize_alloc</span><span class="op">(</span>N_h <span class="op">=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">Nhat_h</span>,</span>
<span>                                       phibar_h <span class="op">=</span> <span class="va">pevs_adm_2016_rrs</span><span class="op">$</span><span class="va">rr_h</span>,</span>
<span>                                       n_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pevs_adm_allocs_50k</span><span class="op">[</span>,<span class="va">col</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pevs_adm_alloc_summary_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pevs_adm_allocs_50k</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pevs_adm_alloc_summary_table</span> <span class="op">&lt;-</span> <span class="va">pevs_adm_alloc_summary_list</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pevs_adm_alloc_summary_table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_total"</span>, <span class="st">"r_total"</span>, <span class="st">"rr"</span>, </span>
<span>                                            <span class="st">"deff_w"</span>, <span class="st">"eff_resp"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">pevs_adm_alloc_summary_tibble</span> <span class="op">&lt;-</span> </span>
<span>   <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">pevs_adm_alloc_summary_table</span>, rownames <span class="op">=</span> <span class="st">"alloc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   alloc     n_total r_total     rr deff_w eff_resp</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> n_h_Ninv    <span style="text-decoration: underline;">50</span>000   <span style="text-decoration: underline;">6</span>794. 0.136    2.37    <span style="text-decoration: underline;">2</span>865.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> n_h_Nresp   <span style="text-decoration: underline;">50</span>000   <span style="text-decoration: underline;">2</span>865. 0.057<span style="text-decoration: underline;">3</span>   1       <span style="text-decoration: underline;">2</span>865.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> n_h_optA    <span style="text-decoration: underline;">50</span>000   <span style="text-decoration: underline;">4</span>494. 0.089<span style="text-decoration: underline;">9</span>   1.26    <span style="text-decoration: underline;">3</span>570.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> n_h_optE    <span style="text-decoration: underline;">50</span>000   <span style="text-decoration: underline;">4</span>496. 0.089<span style="text-decoration: underline;">9</span>   1.26    <span style="text-decoration: underline;">3</span>570.</span></span>
<span></span>
<span><span class="co">#View the percent increase in effective sample size from optE relative to Ninv </span></span>
<span><span class="co"># and Nresp.</span></span>
<span><span class="va">eff_resp_vec</span> <span class="op">&lt;-</span> <span class="va">pevs_adm_alloc_summary_tibble</span><span class="op">$</span><span class="va">eff_resp</span></span>
<span><span class="va">eff_resp_vec</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">/</span><span class="va">eff_resp_vec</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="co">#&gt; [1] 0.2461351 0.2461351</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Federal Voting Assistance Program. (2017a). 2015-2016 Active Duty
Military dataset. Federal Voting Assistance Program, U.S. Department of
Defense.</p>
<p>Federal Voting Assistance Program (2017b). Post-Election Voting
Surveys: Active Duty Military: Technical report 2016. Technical report,
Federal Voting Assistance Program, U.S. Department of Defense.</p>
<p>Kish, L. (1992). Weighting for unequal Pi. <em>Journal of Official
Statistics</em>, <em>8</em>(2), 183–200.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonathan Mendelson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
